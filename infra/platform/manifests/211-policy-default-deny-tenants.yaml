apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: default-deny-inter-namespace
spec:
  description: "Block all traffic between different namespaces (Tenancy Isolation)"
  endpointSelector:
    matchExpressions:
      - key: io.kubernetes.pod.namespace
        operator: Exists
  ingress:
    - fromEndpoints:
        # Allow system checks
        - matchLabels:
            "k8s:io.kubernetes.pod.namespace": "kube-system"

        # Allow external traffic routing from NGINX Ingress
        - matchLabels:
            "k8s:io.kubernetes.pod.namespace": "ingress-nginx"

        # Allow talking to itself (same namespace)
        - matchExpressions:
            - key: io.kubernetes.pod.namespace
              operator: In
              values:
                - self
